/*! traderLightChart 30-05-2015 */
var TraderLightChart=TraderLightChart||{};TraderLightChart.core=TraderLightChart.core||{},function(a){a.getContainerWidth=function(){},a.getContainerHeight=function(){}}(TraderLightChart.core);var TraderLightChart=TraderLightChart||{};TraderLightChart.LineChart=function(){function a(a){this.options={container_id:"trader_line_chart_container"},this.init()}var b={top:50,bottom:5,left:5,right:5};return a.prototype.init=function(){console.log("init"),this.data=[],this.initContainer(),this.initMainSvg(),this.createScale(),this.createAxis(),this.createMainPlot(),this.conbine()},a.prototype.createScale=function(){console.log("createScale"),this.xScale=techan.scale.financetime().range([0,this.containerWidth]).outerPadding(0),this.yScale=d3.scale.linear().range([this.containerHeight,0])},a.prototype.createAxis=function(){console.log("createAxis"),this.xAxis=d3.svg.axis().scale(this.xScale).orient("top"),this.yAxis=d3.svg.axis().scale(this.yScale).orient("right")},a.prototype.createMainPlot=function(){console.log("createMainPlot"),this.mainPlot=techan.plot.close().xScale(this.xScale).yScale(this.yScale),this.accessor=this.mainPlot.accessor()},a.prototype.initContainer=function(){console.log("initContainer"),this.containerSelector=d3.select("body div[id="+this.options.container_id+"]"),this.containerWidth=600,this.containerHeight=300,console.log("containerWidth:",this.containerWidth),console.log("containerHeight:",this.containerHeight)},a.prototype.initMainSvg=function(){console.log("initMainSvg"),this.mainSvg=this.containerSelector.append("svg").attr("width",this.containerWidth).attr("height",this.containerHeight).append("g").attr("transform","translate("+b.left+","+b.top+")")},a.prototype.conbine=function(){console.log("conbine"),this.mainSvg.append("g").attr("class","close"),this.mainSvg.append("g").attr("class","x axis").attr("transform","translate(0,"+(this.containerHeight-b.top)+")"),this.mainSvg.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Price ($)")},a.prototype.feedData=function(a){console.log("feedData"),this.data=this.data.concat(a),console.log("data:",this.data)},a.prototype.bindData=function(){console.log("bindData"),this.mainSvg.select("g.close").datum(this.data)},a.prototype.draw=function(){console.log("draw"),this.bindData(),this.xScale.domain(this.data.map(this.accessor.d)),this.yScale.domain(techan.scale.plot.ohlc(this.data,this.accessor).domain()),this.mainSvg.select("g.x.axis").call(this.xAxis),this.mainSvg.select("g.y.axis").call(this.yAxis),this.mainSvg.select("g.close").call(this.mainPlot)},a}();var TraderLightChart=TraderLightChart||{};TraderLightChart.CandleChart=function(){function a(a){this.options={container_id:"trader_candle_chart_container"},this.init()}var b={top:20,bottom:30,left:50,right:50};return a.prototype.init=function(){console.log("init"),this.data=[],this.zoomAssociated=!1,this.initContainer(),this.initMainSvg(),this.createBehavior(),this.createScale(),this.createAxis(),this.createMainPlot(),this.createAxisAnnotation(),this.createCrossHair(),this.conbine()},a.prototype.createBehavior=function(){var a=this;this.zoom=d3.behavior.zoom().on("zoom",function(){a.zoomed()})},a.prototype.createScale=function(){console.log("createScale"),this.xScale=techan.scale.financetime().range([0,this.containerWidth-b.left-b.right]).outerPadding(0),this.yScale=d3.scale.linear().range([this.containerHeight-b.top-b.bottom,0]),this.yScaleOfVolume=d3.scale.linear().range([this.yScale(0),this.yScale(.2)])},a.prototype.createAxis=function(){console.log("createAxis"),this.xAxis=d3.svg.axis().scale(this.xScale).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.yScale).orient("right"),this.volumeAxis=d3.svg.axis().scale(this.yScaleOfVolume).orient("right").ticks(3).tickFormat(d3.format(",.3s"))},a.prototype.createMainPlot=function(){console.log("createMainPlot"),this.mainPlot=techan.plot.ohlc().xScale(this.xScale).yScale(this.yScale),this.accessor=this.mainPlot.accessor(),this.volume=techan.plot.volume().accessor(this.accessor).xScale(this.xScale).yScale(this.yScaleOfVolume)},a.prototype.createAxisAnnotation=function(){this.timeAnnotation=techan.plot.axisannotation().axis(this.xAxis).format(d3.time.format("%Y-%m-%d")).width(65).translate([0,this.containerHeight-b.top-b.bottom]),this.ohlcAnnotation=techan.plot.axisannotation().axis(this.yAxis).format(d3.format(",.2fs")).translate([this.xScale(1),0]),this.closeAnnotation=techan.plot.axisannotation().axis(this.yAxis).accessor(this.accessor).format(d3.format(",.2fs")).translate([this.xScale(1),0]),this.volumeAnnotation=techan.plot.axisannotation().axis(this.volumeAxis).width(35)},a.prototype.createCrossHair=function(){this.crosshair=techan.plot.crosshair().xScale(this.xScale).yScale(this.yScale).xAnnotation(this.timeAnnotation).yAnnotation([this.ohlcAnnotation,this.volumeAnnotation])},a.prototype.initContainer=function(){console.log("initContainer"),this.containerSelector=d3.select("body div[id="+this.options.container_id+"]"),this.containerWidth=600,this.containerHeight=300,console.log("containerWidth:",this.containerWidth),console.log("containerHeight:",this.containerHeight),this.maxVisiableBars=120},a.prototype.initMainSvg=function(){console.log("initMainSvg");var a=this.containerSelector.append("svg").attr("width",this.containerWidth).attr("height",this.containerHeight),c=a.append("defs");c.append("clipPath").attr("id","ohlcClip").append("rect").attr("x",0).attr("y",0).attr("width",this.containerWidth-b.left-b.right).attr("height",this.containerHeight-b.top-b.bottom),this.mainSvg=a.append("g").attr("transform","translate("+b.left+","+b.top+")")},a.prototype.conbine=function(){console.log("conbine");var a=this.mainSvg.append("g").attr("class","ohlc").attr("transform","translate(0,0)");a.append("g").attr("class","volume").attr("clip-path","url(#ohlcClip)"),a.append("g").attr("class","candlestick").attr("clip-path","url(#ohlcClip)"),this.mainSvg.append("g").attr("class","x axis").attr("transform","translate(0,"+(this.containerHeight-b.top-b.bottom)+")"),this.mainSvg.append("g").attr("class","y axis").attr("transform","translate("+this.xScale(1)+",0)"),this.mainSvg.append("g").attr("class","close annotation up"),this.mainSvg.append("g").attr("class","volume axis"),this.mainSvg.append("g").attr("class","crosshair ohlc")},a.prototype.feedData=function(a){console.log("feedData"),this.data=this.data.concat(a),console.log("data:",this.data)},a.prototype.bindData=function(){console.log("bindData"),this.mainSvg.select("g.candlestick").datum(this.data);var a=this.data[this.data.length-1];console.log("lastDatum:",a),this.mainSvg.select("g.close.annotation").datum([a]),this.mainSvg.select("g.volume").datum(this.data)},a.prototype.draw=function(){console.log("draw"),this.bindData(),this.xScale.domain(techan.scale.plot.time(this.data).domain()),this.xScale.zoomable().domain(this.domainInVisiable()),this.yScale.domain(techan.scale.plot.ohlc(this.dataInVisiable()).domain()),this.yScaleOfVolume.domain(techan.scale.plot.volume(this.dataInVisiable()).domain()),this.mainSvg.select("g.x.axis").call(this.xAxis),this.mainSvg.select("g.y.axis").call(this.yAxis),this.mainSvg.select("g.volume.axis").call(this.volumeAxis),this.mainSvg.select("g.candlestick").call(this.mainPlot),this.mainSvg.select("g.close.annotation").call(this.closeAnnotation),this.mainSvg.select("g.volume").call(this.volume),this.mainSvg.select("g.crosshair.ohlc").call(this.crosshair).call(this.zoom),this.zoomAssociated||(console.log("zoomAssociated"),console.log("zoomable:",this.xScale.zoomable()),console.log("zoomable:",this.xScale.zoomable()),this.zoom.x(this.xScale.zoomable()).y(this.yScale),this.zoomAssociated=!0)},a.prototype.dataInVisiable=function(){var a=this.domainInVisiable();return this.data.slice(a[0],a[1])},a.prototype.domainInVisiable=function(){return this.maxVisiableBars>this.data.length?[0,this.data.length]:[this.data.length-this.maxVisiableBars,this.data.length]},a.prototype.zoomed=function(a){console.log("zoomed"),this.zoom.translate(),this.mainSvg.select("g.x.axis").call(this.xAxis),this.mainSvg.select("g.y.axis").call(this.yAxis),this.mainSvg.select("g.volume.axis").call(this.volumeAxis),this.mainSvg.select("g.candlestick").call(this.mainPlot.refresh),this.mainSvg.select("g.close.annotation").call(this.closeAnnotation.refresh),this.mainSvg.select("g.volume").call(this.volume.refresh),this.mainSvg.select("g.crosshair.ohlc").call(this.crosshair.refresh)},a}();